<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Estación Meteorológica Campus Puebla</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/2-col-portfolio.css" rel="stylesheet">
	 <link href="css/jquery-ui.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	  <div class="container">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
	        <span class="sr-only">Toggle navigation</span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a class="navbar-brand" href="index.html">Estación Meteorológica Campus Puebla</a>
	    </div>

	    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
	      <ul class="nav navbar-nav">
	        <li><a href="acercade.html">Acerca de la estaci&oacute;n</a></li>
		  	</ul>
			 <ul class="nav navbar-nav navbar-right">
			  <li><a href="http://www.itesm.mx/wps/wcm/connect/Campus/PUE/Puebla/" style="padding: 0px 0px 0px 0px;"><img class="displayed" src="iconos/ITESMLogo.png"></img></a></li>
			  <li><a href="http://www.itesm.mx/wps/wcm/connect/Campus/PUE/Puebla/" style="padding: 0px 0px 0px 0px;"><img class="displayed" src="iconos/ITESMLogo2-01.png"></img></a></li>
	      </ul>
	    </div>
	  </div>
	</nav>
	
	<div class="container">
		<!-- Page Header -->
		<div class="row" id="pageheader">
			<div class="col-lg-9">
				<h1 class="page-header">Condiciones actuales 
					<small>Actualizado cada 10 minutos</small>
            </h1>
         </div>
     	</div> <!-- listo pageheader-->
		
		<!-- fila de cuadritos y tabla -->
			<div class="row">
      		<div class="col-md-9 portfolio-item">
          		<div class="row" style=" margin-top: 20px;">
				 		<div class="col-md-3 portfolio-item" id="hora">
				 			<div class=" cubitos" style="background-color: #3592c6;">
					 			<div class="row">
							 		<div class="col-sm-12">
						 		 		<span class="" id="demo" title="Hora"></span>
							 		</div>
								</div>
								<div class="row">
									<div class="col-sm-6">
										<span class="" style="font-size: 25px;">hrs</span>
									</div>
									<div class="col-sm-6">
										<img class="img-responsive" src="iconos/Hora.png">
									</div>
								</div>
				 			</div>
					</div> <!-- listo hora -->
				 		<div class="col-md-3 portfolio-item" id="temperatura">
					 		<div class=" cubitos" style="background-color: red;">
						 		<div class="row">
							 		<div class="col-sm-12">
						 		 		<span class="" id="demo1" title="Temperatura ambiente"></span>
							 		</div>
								</div>
								<div class="row">
									<div class="col-sm-6">
										<span class="">C&deg;</span>
									</div>
									<div class="col-sm-6">
										<img class="img-responsive" src="iconos/Temperatura.png">
									</div>
								</div>
							</div> 
						</div> <!-- listo temperatura -->
				 		<div class="col-md-3 portfolio-item" id="humedad">
					 	<div class=" cubitos" style="background-color: green;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo2" title="Humedad relativa"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="">%</span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/Humedad.png">
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo humedad-->
				 		<div class="col-md-3 portfolio-item" id="precipitacion">
					 	<div class=" cubitos" style="background-color: purple;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo6" title="Precipitaci&oacute;n acumulada"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="" style="font-size: 25px;padding-top: 15px;padding-bottom: 15px;">mm</span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/Precipitacion.png">
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo precipitacion-->
			 		</div>
         		<div class="row">
				 		<div class="col-md-3 portfolio-item" id="rocio">
					 	<div class=" cubitos" style="background-color: black;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo3" title="Punto roc&iacute;o"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="">C&deg;</span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/Rocio.png"/>
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo rocio-->
				 		<div class="col-md-3 portfolio-item" id="presionatmo">
					 	<div class=" cubitos" style="background-color: orange;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo4" title="Presion atmosf&eacute;rica"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="" style="font-size: 25px;padding-top: 15px;padding-bottom: 15px;">mmHg</span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/PresionAtmosferica.png"/>
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo presionatmo-->
				 		<div class="col-md-3 portfolio-item" id="raciacion">
					 	<div class=" cubitos" style="background-color: brown;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo5" title="Radiaci&oacute;n solar"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="" style="font-size: 25px;padding-top: 15px;padding-bottom: 15px;">w/m<sup>2</sup></span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/RadiacionSolar.png"/>
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo radiacion-->
				 		<div class="col-md-3 portfolio-item" id="evaporacion">
					 	<div class="cubitos" style="background-color: #FE72C4;">
						 	<div class="row">
							 	<div class="col-sm-12">
						 		 	<span class="" id="demo7" title="Evaporaci&oacute;n acumulada"></span>
							 	</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<span class="" style="font-size: 25px;padding-top: 15px;padding-bottom: 15px;">mm</span>
								</div>
								<div class="col-sm-6">
									<img class="img-responsive" src="iconos/Evaporacion.png"/>
								</div>
							</div>
					 	</div>
				 	</div> <!-- listo evaporacion-->
					</div>
				</div> <!-- columna de cuadraditos-->
				
				<div class="col-md-3 portfolio-item" id="tabla">

						

				</div> <!-- columna de tabla-->
				
			</div><!-- fin row -->
		<!-- fin de fila de cuadritos y tabla -->
		
		<div class="row" id="logs">
			<div class="col-md-6">
				<h2 class="page-header">Registro completo</h2>
				
				
				<!-- opcional MODAL ><ul class="list-group">
				  <li class="list-group-item">
				    <span class="badge" data-toggle="modal" data-target="#hola" style="cursor: pointer;">info</span>
				     Todas las mediciones por día
				  </li>
				</ul> -->
					<div class="panel panel-info">
					  <div class="panel-body">
 					  	<div class="form-group">
							<fieldset>
 							<p for="select" class="col-md-4 control-label">Seleccione un archivo para descargar (L1aaMMdd)</p>
 							<div class="col-md-8">
 								<select multiple="" class="form-control" id="selection">
				            
 					          </select>
 							 </div>
							 </fieldset>
 						 </div>	 
					  </div>
					 <div class="panel-footer">
						 <button type="button" class="btn btn-primary"><a id="desc" style="color: white;" href="" target="_blank">Descargar</a></button>
					 </div>
					</div>	 
			</div>
			<div class="col-md-6">
							<h3 class="page-header">Temperatura del d&iacute;a anterior entre las 9:00 y 21:00 horas</h3>
								<div style="background-color: black;">
									<span class="inlinesparkline" id="sparkline"></span>
								</div>
								<div class="row">
									<div class="col-sm-3">
										<div class="badge" style="margin-left: 22%;">09:00</div>
									</div>
									<div class="col-sm-3">
										<div class="badge" style="margin-left: 33%;">13:00</div>
									</div>
									<div class="col-md-3">
										<div class="badge" style="margin-left: 39%;">17:00</div>
									</div>
									<div class="col-md-3">
										<div class="badge" style="margin-left: 45%;">21:00</div>
									</div>
								</div>
								
						</div>
		</div>
		
		<!-- MODAL optional -->
		
		<!-- <div class="modal" id="hola">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		        <h4 class="modal-title">Registro meteorol&oacute;gico diario</h4>
		      </div>
		      <div class="modal-body">
					<fieldset>
				  	<div class="form-group">
						<label for="select" class="col-lg-2 control-label">Seleccione: (L1aaMMdd)</label>
						<div class="col-lg-10">
							<select multiple="" class="form-control" id="selection">
				            
				          </select>
						 </div>
					 </div>
					 </fieldset>
		      </div>
		      <div class="modal-footer">
					<p style="float: left; font-size: 10px;">* Safari, para descargar: click derecho y "Save link as"</p>
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="button" class="btn btn-primary"><a id="desc" style="color: white;" href="" target="_blank">Descargar</a></button>
		      </div>
		    </div>
		  </div>
		</div> -->
		
		<!-- Footer -->
     <footer>
         <div class="row">
             <div class="col-lg-12">
                 <p style="font-size: 12px;">Instituto Tecnol&oacute;gico y de Estudios Superiores de Monterrey Campus Puebla 2015&copy;</p>
             </div>
         </div> <!-- /.row --> 
     </footer>
	  
	  
	</div><!-- fin de container-->
    
	
    <!-- jQuery -->
    <script src="js/jquery.js"></script>
	 
	 <script src="js/jquery-ui.min.js"></script>
	 
	 <script src="js/jquery.sparkline.js"></script>
	 
	 <script type='text/javascript' src='Datejs-master/src/globalization/es-MX.js'></script>
    <script type='text/javascript' src='Datejs-master/src/core.js'></script>
    <script type='text/javascript' src='Datejs-master/src/sugarpak.js'></script>
    <script type='text/javascript' src='Datejs-master/src/parser.js'></script>
	 
    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
	 
	 
	 
	 <script>
	 $(document).ready(function(){
		 
		 /* date function for getting the last day's file */
		 var today = Date.today().addDays(-1);
		 var todayStr = today.toDateString().toString();
		 var day = todayStr.substring(8,10);
		 var month = Date.getMonthNumberFromName(todayStr.substring(4,7));
		 month = getM(month);
		 var year = todayStr.substring(13);
		 function getM(m){
			 var month2 = parseInt(m);
			 month2 += 1;
			 if(month2 < 10){
				 month2 = month2.toString();
				 month2 = "0"+month2;
			 }
			 return month2;
		 }
		 
		 
		 
		 /* end function for getting the last day's file */
		 
		 
		 
		 loadIt(); //call this function to load when the page starts and not every 10 seconds
		 
		/*function for loading the data of every 10 minutes*/
		function loadIt(){
			xmlhttp=new XMLHttpRequest();
		 	xmlhttp.open("GET","text.txt",true);
		 	xmlhttp.send();
		 	xmlhttp.onreadystatechange=function()
		 	{
		 		if (xmlhttp.readyState==4 && xmlhttp.status==200)
		 		{
		 			procesaTexto(xmlhttp.responseText);
		 		}
		 	}
  		 var d = new Date();
  		 document.getElementById("demo").innerHTML = d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
		}
		
		function loadIt2(y,m,d){
			xmlhttp=new XMLHttpRequest();
		 	xmlhttp.open("GET","mediciones/L1" + year + "" + month + "" + day + ".csv" ,true);
		 	xmlhttp.send();
		 	xmlhttp.onreadystatechange=function()
		 	{
		 		if (xmlhttp.readyState==4 && xmlhttp.status==200)
		 		{
		 			processDayBeforeData(xmlhttp.responseText);
		 		}
		 	}
		}
		
		
		
		/* interval for loading the updated values of the color squares */
		setInterval(function(){
			loadIt(); // this will run after every 5 seconds
		}, 10000);
	 	
		function processDayBeforeData(allText){
	     	var allTextLines = allText.split(/\r\n|\n/);
	     	var headers = allTextLines[0].split(',');
	     	var lines = [];
	     	for (var i=1; i<allTextLines.length; i++) {
	         	var data = allTextLines[i].split(',');
	         	if (data.length == headers.length) {
	 				var tarr = [];
	             for (var j=0; j<headers.length; j++) {
	 					tarr.push(data[j]);
	             }
	             lines.push(tarr);
	         	}
	 		  	//alert(lines[i]);
	    }
		 var hod = [];
		 hod[0] = lines[10][2];
		 hod[1] = lines[11][2];
		 hod[2] = lines[12][2];
		 hod[3] = lines[13][2];
		 hod[4] = lines[14][2];
		 hod[5] = lines[15][2];
		 hod[6] = lines[16][2];
		 hod[7] = lines[17][2];
		 hod[8] = lines[18][2];
		 hod[9] = lines[19][2];
		 hod[10] = lines[20][2];
		 hod[11] = lines[21][2];
		 hod[12] = lines[22][2];
		 
		 $("#sparkline").sparkline([hod[0],hod[1],hod[2],hod[3],hod[4],hod[5],hod[6],hod[7],hod[8],hod[9],hod[10],hod[11],hod[12]], {
		     type: 'line',
		     width: '100%',
		     height: '',
		     lineColor: '#ffffff',
		     fillColor: '#000000',
		     spotColor: '',
		     minSpotColor: 'white',
		     maxSpotColor: 'red',
		     highlightLineColor: '#ffffff',
			 highlightSpotColor: '',
			 lineWidth: 3,
		     spotRadius: 7,
		     chartRangeMin: undefined,
		     chartRangeMax: undefined,
		     chartRangeMinX: undefined,
		     chartRangeMaxX: undefined,
			 valueSpots: {':14': 'white', '14:15': '#99EBFF', '15:16': '#417B8E', '16:17': 'yellow', '17:18': 'orange', '18:19': '#FF6666', '19:': 'red'},
		     drawNormalOnTop: false});
		}
		
	 	function processData(allText) {
	     	var allTextLines = allText.split(/\r\n|\n/);
	     	var headers = allTextLines[0].split(',');
	     	var lines = [];
	     	for (var i=1; i<allTextLines.length; i++) {
	         	var data = allTextLines[i].split(',');
	         	if (data.length == headers.length) {
	 				var tarr = [];
	             for (var j=0; j<headers.length; j++) {
	 					tarr.push(data[j]);
	             }
	             lines.push(tarr);
	         	}
	 		  	//alert(lines[i]);
	    }
		 
		 
		 
		//document.getElementById("demo").innerHTML = lines[1][0];
	  	document.getElementById("demo1").innerHTML = lines[1][2];
	 	document.getElementById("demo2").innerHTML = lines[1][10];
	  	document.getElementById("demo3").innerHTML = lines[1][18];
	  	document.getElementById("demo4").innerHTML = lines[1][26];
	  	document.getElementById("demo5").innerHTML = lines[1][34];
		document.getElementById("demo6").innerHTML = lines[1][44];
		document.getElementById("demo7").innerHTML = lines[1][50];
	 }
	 
	 function procesaTexto(texto){
		 var texto1 = texto.substr(6, texto.length);
		 var arr = texto1.split("\t");
		 var i = 0;
		 //console.log(arr);
		 while(i < arr.length){
		 	 arr[i] = arr[i].replace(/\s+/g, "");
			 i++;
		 }
		 console.log(arr);
		 
		 document.getElementById("demo1").innerHTML = arr[0];//temperatura
		 document.getElementById("demo2").innerHTML = arr[3];//humedad relativa
		 document.getElementById("demo3").innerHTML = arr[6];//punto de rocio
		 document.getElementById("demo4").innerHTML = arr[9];//presion atmosferica
		 document.getElementById("demo5").innerHTML = arr[0];//radiacion solar
		 document.getElementById("demo6").innerHTML = arr[12];//precipitacion acum
		 document.getElementById("demo7").innerHTML = arr[15];//evaporacion acum
	 }
	 
   $(function() {
     $("#demo").tooltip();
	  $("#demo1").tooltip();
	  $("#demo2").tooltip();
	  $("#demo3").tooltip();
	  $("#demo4").tooltip();
	  $("#demo5").tooltip();
	  $("#demo6").tooltip();
	  $("#demo7").tooltip();
   });
	
 loadIt2(year,month,day);
 console.log("L1" + year + "" + month + "" + day + ".csv"); //this is the string to put in the last day's .csv
	
	/* downloadable files function*/
	var dir = "mediciones/";
	var fileextension = ".csv";
	$.ajax({
	    //This will retrieve the contents of the folder if the folder is configured as 'browsable'
	    url: dir,
	    success: function (data) {
	        //Lsit all png file names in the page
	        $(data).find("a:contains(" + fileextension + ")").each(function () {
	            var filename = this.href.replace(window.location.href, "").replace("http:///", "");
	            $("#selection").append($("<option>" + filename + "</option>"));
	        });
	    }
	});
	
	$("#desc").click(function(){
		var u = $("#selection option:selected").val();
		$(this).attr("href", dir+u);
	});
	 /* end of downloadable files function */
	 });
	 </script>
	 
	 
</body>

</html>
